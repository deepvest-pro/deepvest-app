# DeepVest: Грантовая система на базе ИИ и Блокчейна (Мозговой штурм Gemini)

## 1. Введение

Цель этого документа - разработать концепцию и MVP (минимально жизнеспособный продукт) для новой функциональности платформы DeepVest: системы получения грантов для стартапов от фондов и DAO (децентрализованных автономных организаций). Система будет активно использовать ИИ-агентов для обеих сторон (стартапов и фондов) и технологию блокчейн для прозрачности и автоматизации выплаты средств по достижении ключевых этапов (мейлстоунов).

Идея основана на предложении интегрировать ИИ-агентов, которые могут анализировать потребности проекта (например, задачи на GitHub), формировать грантовые заявки, и взаимодействовать с ИИ-агентами фондов для получения финансирования. Верификация выполнения мейлстоунов и последующие выплаты будут регистрироваться и осуществляться через блокчейн.

## 2. Основная концепция

Создать экосистему внутри DeepVest, где стартапы могут:

- Находить фонды/DAO, предоставляющие гранты.
- Использовать ИИ-агента для подготовки и подачи структурированных грантовых заявок, основанных на реальных потребностях проекта и публичных данных (например, из GitHub).
- Четко определять мейлстоуны и ожидаемые результаты для получения каждого транша гранта.

Фонды/DAO смогут:

- Публиковать информацию о своих грантовых программах.
- Использовать ИИ-агента для первичной оценки заявок, мониторинга активности стартапов и верификации выполнения мейлстоунов.
- Автоматизировать процесс выплаты средств через смарт-контракты при подтверждении достижения мейлстоунов.

Блокчейн обеспечит:

- Прозрачность условий гранта (смарт-контракт).
- Автоматизированные и доверенные выплаты по достижении мейлстоунов (через оракулы).
- Неизменяемую историю транзакций и выполнения обязательств.

## 3. Ключевые участники и их роли

- **Стартапы:** Проекты, ищущие финансирование для развития.
  - **ИИ-агент стартапа:**
    - Анализирует открытые задачи (например, GitHub issues), дорожную карту проекта в DeepVest.
    - Помогает формулировать грантовые заявки с конкретными мейлстоунами и KPI.
    - Отслеживает прогресс по мейлстоунам и собирает доказательства их выполнения (например, ссылки на PR, коммиты).
    - Уведомляет ИИ-агента фонда о достижении мейлстоунов.
- **Фонды/DAO (Грантодатели):** Организации, предоставляющие гранты.
  - **ИИ-агент фонда/DAO:**
    - Оценивает грантовые заявки по заданным критериям.
    - Мониторит активность стартапа (через API DeepVest, GitHub и др.).
    - Верифицирует выполнение мейлстоунов на основе предоставленных доказательств и данных мониторинга.
    - Инициирует выплаты через смарт-контракт после подтверждения мейлстоуна.
- **Разработчики (опционально, могут быть частью команды стартапа или внешние):** Исполняют задачи, связанные с мейлстоунами. Их активность (коммиты, PR) может служить доказательством.

## 4. Предлагаемые изменения в структуре данных DeepVest

Необходимо расширить существующие или добавить новые сущности:

- **Расширение `FundingRound` (существующая таблица):**

  - При `type: "grant"` добавить поля:
    - `fund_dao_id` (UUID, ссылка на новую таблицу `FundsDAO`).
    - `grant_proposal_content_id` (UUID, ссылка на `ProjectContent` с типом "grant_proposal").
    - `grant_smart_contract_address` (TEXT, адрес смарт-контракта гранта).
    - `total_grant_amount_requested` (NUMERIC).
    - `total_grant_amount_approved` (NUMERIC).
    - `amount_disbursed` (NUMERIC, обновляется после каждого транша).
    - `startup_wallet_address` (TEXT, кошелек стартапа для получения средств).
    - `status`: расширить возможными значениями, специфичными для грантов (`proposal_submitted`, `proposal_rejected`, `agreement_pending`, `active_grant`, `completed`, `cancelled_by_fund`, `cancelled_by_startup`).

- **Расширение `Milestone` (существующая таблица):**

  - Добавить поля:
    - `funding_round_id` (UUID, ссылка на `FundingRound` грантового типа).
    - `amount_payable` (NUMERIC, сумма, выплачиваемая по завершении этого мейлстоуна).
    - `verification_status_by_fund_ai` (ENUM: `pending_review`, `approved`, `rejected`, `requires_more_info`).
    - `fund_ai_comment` (TEXT, комментарий от ИИ-агента фонда по верификации).
    - `on_chain_verification_tx_hash` (TEXT, хеш транзакции, подтверждающей верификацию через оракул).
    - `disbursement_tx_hash` (TEXT, хеш транзакции выплаты).

- **Новая таблица `FundsDAO`:**

  - `id` (UUID, PK)
  - `name` (TEXT)
  - `description` (TEXT)
  - `type` (ENUM: `fund`, `dao`, `accelerator`)
  - `wallet_address` (TEXT, основной кошелек фонда/DAO)
  - `ai_agent_config_url` (TEXT, URL или идентификатор конфигурации для их ИИ-агента)
  - `website_url` (TEXT)
  - `contact_email` (TEXT)
  - `supported_blockchains` (TEXT[])
  - `grant_program_details_url` (TEXT, ссылка на описание их грантовой программы)
  - `created_at`, `updated_at`

- **Новый тип `ProjectContent` (расширение существующей таблицы):**
  - `content_type`: добавить `"grant_proposal"`.
  - `content` (Markdown): будет содержать структурированное предложение, сгенерированное ИИ-агентом стартапа, включая описание проблемы, решение, команду, запрашиваемую сумму, и детальный план мейлстоунов.

## 5. Процесс взаимодействия (Grant Lifecycle)

1.  **Публикация грантовых программ:** Фонды/DAO регистрируются на DeepVest и публикуют информацию о своих грантовых программах (через профиль `FundsDAO`).
2.  **Обнаружение и Подача Заявки:**
    - Стартап находит подходящую программу.
    - ИИ-агент стартапа (используя, например, Gemini API через эндпоинт `/api/ai/generate-content`) помогает подготовить `ProjectContent` типа `"grant_proposal"`. Этот proposal будет содержать детальный план с задачами (возможно, привязанными к GitHub issues) и предлагаемыми `Milestone`.
    - Стартап подает заявку, создается `FundingRound` с `type="grant"` и статусом `"proposal_submitted"`.
3.  **Оценка Заявки Фондом:**
    - ИИ-агент фонда/DAO получает уведомление, анализирует `grant_proposal` и данные о стартапе из DeepVest.
    - Принимает решение: отклонить (`status="proposal_rejected"`) или запросить доп. информацию, или одобрить (`status="agreement_pending"`).
4.  **Заключение Соглашения и Развертывание Смарт-Контракта:**
    - При одобрении, согласуются окончательные условия, сумма, мейлстоуны и KPI.
    - Разворачивается (или настраивается существующий) смарт-контракт для гранта. Адрес контракта сохраняется в `FundingRound.grant_smart_contract_address`.
    - Фонд депонирует средства в смарт-контракт (полностью или по частям).
    - Статус `FundingRound` меняется на `"active_grant"`.
5.  **Выполнение и Верификация Мейлстоунов:**
    - Стартап выполняет работу по `Milestone`.
    - ИИ-агент стартапа отслеживает прогресс (например, закрытие GitHub issues, мерж PR, достижение метрик) и загружает `proof_urls` в `Milestone`.
    - ИИ-агент стартапа уведомляет ИИ-агента фонда о готовности мейлстоуна к проверке.
    - ИИ-агент фонда проверяет доказательства (может включать анализ кода, проверку доступности функционала).
    - `Milestone.verification_status_by_fund_ai` обновляется.
6.  **Выплата Средств:**
    - При `Milestone.verification_status_by_fund_ai = "approved"`, ИИ-агент фонда инициирует транзакцию через оракула (например, Chainlink) для информирования смарт-контракта.
    - Смарт-контракт автоматически перечисляет соответствующую сумму (`Milestone.amount_payable`) на кошелек стартапа (`FundingRound.startup_wallet_address`).
    - Записываются `Milestone.on_chain_verification_tx_hash` и `Milestone.disbursement_tx_hash`.
    - `FundingRound.amount_disbursed` обновляется.
    - `Milestone.status` меняется на `"completed"`.
7.  **Завершение Гранта:** Когда все мейлстоуны выполнены и средства выплачены, `FundingRound.status` меняется на `"completed"`.

## 6. MVP для Хакатона (2 дня)

**Цель MVP:** Продемонстрировать основной цикл: подача упрощенной заявки стартапом, ручное "одобрение" заявки и мейлстоуна представителем фонда, и имитация выплаты через блокчейн по выполнению мейлстоуна. Показать основной флоу и потенциал идеи.

**Упрощения для MVP на основе ответов:**

- **ИИ-агенты:**
  - **Стартап:** Использует существующий Gemini API (через эндпоинт DeepVest `/api/ai/generate-content`) **только для помощи в написании текстового описания** для заявки. Анализ GitHub issues, RFQ и т.д. **не входит в MVP**. Стартап самостоятельно определяет содержание и цели заявки.
  - **Фонд:** **Полностью заменяется человеком-представителем фонда**. Никакого ИИ для оценки или мониторинга. Представитель фонда использует простой интерфейс для просмотра заявок и ручного одобрения/отклонения заявок и мейлстоунов.
- **Взаимодействие:** Четкий флоу "человек-система-человек". Стартап (человек) создает заявку в системе. Представитель фонда (человек) рассматривает ее в системе и принимает решения.
- **Блокчейн:**
  - **Смарт-контракт:** Простейший смарт-контракт на **Neon EVM**. Функционал: депонирование средств фондом и выплата средств стартапу по команде от "одобренного" адреса (имитация оракула). **Никаких сложных механик DAO, голосований, разрешения споров.**
  - **Оракул:** **Полная имитация бэкендом.** После ручного одобрения мейлстоуна представителем фонда, бэкенд напрямую вызывает функцию смарт-контракта для выплаты. Chainlink упоминается как возможное развитие.
  - **Безопасность:** Минимальная, достаточная для демонстрации на хакатоне.
- **Отслеживание Активности:** Вместо автоматического трекинга GitHub, стартап **вручную прикладывает ссылку** на коммит/PR или просто текстовое описание выполненной работы как `proof_url` для мейлстоуна.
- **Интерфейс:** Минимальные изменения в существующем интерфейсе DeepVest для отображения грантовых заявок и мейлстоунов.
- **Данные о грантовых программах фонда:** Для MVP фонд просто указывает свое название. Детальное описание программ, критериев и т.д. – за рамками.
- **Процессы:**
  - **Никакого разрешения споров.**
  - **Одна заявка на один грант** от стартапа для простоты.
  - **Никакой обработки уже существующих грантов** или сложных условий.

**Ключевые компоненты MVP:**

1.  **Модель данных (упрощенная для MVP):**
    - В `FundingRound` с `type = "grant"`:
      - `fund_name` (TEXT, просто название фонда, вместо FK на `FundsDAO`).
      - `grant_proposal_text` (TEXT, сгенерированное с помощью Gemini описание).
      - `requested_amount` (NUMERIC).
      - `startup_wallet_address` (TEXT, кошелек Neon EVM стартапа).
      - `grant_smart_contract_address` (TEXT, опционально, если разворачивается заранее).
      - `status` (`proposal_submitted`, `proposal_approved_by_fund`, `milestone_achieved`, `funds_disbursed`, `proposal_rejected_by_fund`).
    - В `Milestone` (один-два мейлстоуна на заявку для MVP):
      - `funding_round_id` (FK).
      - `description` (TEXT).
      - `amount_payable` (NUMERIC).
      - `proof_url` (TEXT, ссылка или описание от стартапа).
      - `status` (`pending`, `submitted_for_review`, `approved_by_fund`, `paid`).
2.  **Frontend:**
    - Страница для стартапа, где можно создать "грантовую заявку" (новый `FundingRound` с `type="grant"`), указав название фонда, сумму, описание, и 1-2 мейлстоуна. Использовать Gemini для генерации описания.
    - Простой дашборд для "фонда" для просмотра заявок и одобрения/отклонения их, а также одобрения мейлстоунов.
3.  **Backend:**
    - API для создания "грантовой заявки" (`FundingRound` и связанные `Milestone`).
    - API для "фонда" для изменения статусов заявок и мейлстоунов.
    - Логика для "одобрения" мейлстоуна, которая триггерит вызов функции на смарт-контракте (имитация оракула).
4.  **Смарт-контракт (Neon EVM):**
    - `depositGrant(amount)`: вызывается представителем фонда (или бэкендом от его имени) для внесения средств.
    - `releaseMilestonePayment(recipientAddress, amount)`: вызывается бэкендом (имитация оракула) для выплаты стартапу.

**Демонстрационный флоу MVP:**

1.  Стартап (пользователь) на специальной странице создает "грантовую заявку":
    - Вводит название своего проекта.
    - Использует интегрированный Gemini (через DeepVest API) для генерации убедительного описания/цели гранта.
    - Указывает запрашиваемую сумму.
    - Указывает свой кошелек Neon EVM.
    - Определяет 1-2 простых мейлстоуна с суммами для каждого.
    - Указывает (выбирает из списка или вводит текстом) "Фонд X".
2.  Представитель "Фонда X" (другой пользователь с соответствующей ролью) видит новую заявку в своем дашборде.
3.  Представитель фонда одобряет заявку.
    - _Опционально (для показа блокчейн-части):_ Бэкенд может на этом этапе создать/указать адрес простого смарт-контракта на Neon EVM (заранее подготовленного). Фонд (или бэкенд от его имени) депонирует средства на этот контракт через функцию `depositGrant`.
4.  Стартап выполняет первый мейлстоун (например, делает коммит, пишет об этом).
5.  Стартап заходит в систему и помечает мейлстоун как "готовый к проверке", прикладывая ссылку/описание.
6.  Представитель фонда видит, что мейлстоун готов к проверке, "проверяет" его (смотрит на ссылку/описание) и одобряет.
7.  Бэкенд (имитируя оракул) реагирует на одобрение и вызывает функцию `releaseMilestonePayment` на смарт-контракте, указывая кошелек стартапа и сумму мейлстоуна.
8.  Средства (если они были реально депонированы на шаге 3) переводятся на кошелек стартапа. В любом случае, система фиксирует "выплату".
9.  Статус мейлстоуна и заявки обновляется. Показывается информация о "транзакции" (можно просто сгенерировать фейковый хеш для демо).

## 7. Потенциальное развитие после хакатона

- **Полноценные ИИ-агенты:**
  - Агент стартапа: анализ репозиториев, автоматическое формирование мейлстоунов, проактивные предложения по грантам.
  - Агент фонда: скоринг заявок, автоматическая верификация некоторых типов мейлстоунов (анализ кода, тестов, метрик).
- **Интеграция с DAO:** Использование инструментов DAO для голосования по грантам.
- **Более сложные смарт-контракты:** Управление эскроу, поэтапное финансирование, голосование держателей токенов DAO.
- **Реальная интеграция Chainlink:** Для автоматической и децентрализованной верификации данных (например, GitHub Actions -> Chainlink Node -> Smart Contract).
- **Поддержка различных блокчейнов:** Интеграция с Polkadot, Flare, Oasis и др. на основе выбора фондов.
- **Репутационная система:** Для стартапов (история выполнения грантов) и фондов.
- **Интеграция с Origin Trail:** Для отслеживания происхождения и верификации данных о проекте и выполнении мейлстоунов в виде Decentralized Knowledge Graph.
- **Использование Civic:** Для верификации личности основателей стартапов или членов DAO.
- **iExec:** Потенциально для выполнения сложных вычислений ИИ-агентами фонда в децентрализованной и доверенной среде (например, анализ кода).
