# Идея: Краудфандинг для стартапов в DeepVest

## 1. Общая концепция

Реализовать на платформе DeepVest функционал для проведения стартапами краудфандинговых кампаний, разделенных на этапы (мейлстоуны). Инвесторы смогут вкладывать средства на каждом этапе, получая долю в проекте, размер которой зависит от стадии и суммы вложений. Цель — предоставить стартапам инструмент для привлечения начального капитала, а инвесторам — возможность поддержать перспективные проекты на ранней стадии с потенциально высокой доходностью.

Для хакатона предлагается упрощенная модель с использованием блокчейн-технологий для прозрачности и управления средствами.

## 2. Ключевые компоненты и изменения в данных

Потребуются следующие новые сущности и модификации существующих:

### Новые таблицы:

#### а. `CrowdfundingCampaigns` (Краудфандинговые Кампании)

- `id`: UUID, PK
- `project_id`: UUID, FK к `projects`
- `title`: TEXT, название кампании
- `description`: TEXT, описание кампании
- `total_equity_offered_percent`: NUMERIC(5,2), общий процент эквити, предлагаемый инвесторам за всю кампанию (например, 20.00%)
- `start_date`: TIMESTAMP, дата начала кампании
- `end_date`: TIMESTAMP, дата окончания кампании (может быть ориентировочной, если зависит от этапов)
- `status`: ENUM ('draft', 'active', 'successful', 'partially_successful', 'failed', 'cancelled') - статус всей кампании
- `created_at`, `updated_at`: TIMESTAMPS

#### б. `CampaignMilestones` (Этапы Кампании)

- `id`: UUID, PK
- `campaign_id`: UUID, FK к `CrowdfundingCampaigns`
- `milestone_id`: UUID, FK к `Milestones` (существующая таблица, если подходит, или упрощенная структура)
  - _Примечание: Для MVP эта таблица будет содержать всю необходимую информацию об этапе краудфандинга. Связь с основной таблицей `Milestones` (для операционных задач) может быть добавлена позже как опциональная ссылка (например, `operational_milestone_id`), если потребуется глубокая интеграция. На данном этапе `CampaignMilestones` самодостаточны для финансовых целей._
- `title`: TEXT, название этапа (например, "Разработка MVP")
- `description`: TEXT, описание целей этапа
- `target_amount_usd`: NUMERIC, целевая сумма для этапа
- `current_amount_usd`: NUMERIC, DEFAULT 0, текущая собранная сумма
- `equity_for_milestone_percent`: NUMERIC(5,2), процент эквити от _общего эквити компании_, выделяемый на данный этап. (например, если `total_equity_offered_percent` = 20%, то на этап может быть 5%)
- `min_investment_usd`: NUMERIC, DEFAULT 10, минимальная сумма инвестиции (стартап может изменить значение по умолчанию).
- `max_investment_usd`: NUMERIC, максимальная сумма инвестиции от одного инвестора на данном этапе (не может превышать `target_amount_usd - current_amount_usd`).
- `start_date`: TIMESTAMP, дата начала сбора на этап
- `end_date`: TIMESTAMP, дата окончания сбора на этап
- `expected_completion_date`: TIMESTAMP, ожидаемая дата завершения работ по этапу
- `order`: INTEGER, порядковый номер этапа в кампании
- `status`: ENUM ('pending', 'active', 'funded', 'failed_to_fund', 'in_progress_work', 'completed_work', 'cancelled')
- `blockchain_escrow_address`: TEXT, адрес эскроу-контракта для этапа (если используется блокчейн)
- `token_price_per_share_usd`: NUMERIC, условная цена одной "доли" или "фьючерса на акцию" на этом этапе

#### в. `Investments` (Инвестиции)

- `id`: UUID, PK
- `campaign_milestone_id`: UUID, FK к `CampaignMilestones`
- `user_id`: UUID, FK к `auth.users` (инвестор)
- `amount_usd`: NUMERIC, сумма инвестиции
- `equity_units_received`: NUMERIC, количество полученных "юнитов" или "долей" эквити
- `transaction_hash`: TEXT, хэш транзакции (если используется блокчейн)
- `status`: ENUM ('pending_payment', 'confirmed', 'failed_payment', 'refunded')
- `invested_at`: TIMESTAMP
- `created_at`, `updated_at`: TIMESTAMPS

### Модификации существующих таблиц:

- **`Milestones`**: Если решаем использовать существующую таблицу, нужно продумать, как связать ее с `CampaignMilestones` и не смешивать обычные операционные майлстоуны с финансовыми этапами краудфандинга. Возможно, лучше создать отдельную структуру для целей краудфандинга.
- **`ProjectPermissions`**: Убедиться, что только владелец/админ проекта может создавать и управлять краудфандинговой кампанией.

## 3. Механика краудфандинговой кампании

1.  **Создание Кампании Стартапом**:
    - Стартап (владелец проекта) создает `CrowdfundingCampaign`.
    - Определяет `total_equity_offered_percent`.
    - Создает один или несколько `CampaignMilestones`, для каждого указывая:
      - Цели и описание.
      - `target_amount_usd`.
      - `equity_for_milestone_percent` (сумма всех `equity_for_milestone_percent` по этапам не должна превышать `total_equity_offered_percent` кампании, а скорее всего должна быть равна ей, если вся кампания успешна).
      - Сроки сбора (`start_date`, `end_date`).
      - Порядок (`order`).
2.  **Активация Этапа**:
    - Первый этап (`order = 1`) становится `active` после публикации кампании. Последующие этапы активируются только после успешного финансирования (`funded`) И фактического выполнения работ (`completed_work`) предыдущего этапа.
3.  **Инвестирование**:
    - Инвесторы видят активные этапы и могут вкладывать средства.
    - При инвестиции создается запись в `Investments`.
4.  **Завершение Этапа Сбора**:
    - **Успех**: Если `current_amount_usd` >= `target_amount_usd` к `end_date`, этап считается `funded`. Средства (если на эскроу) передаются стартапу. Стартап переводит этап в `in_progress_work`.
    - **Неуспех**: Если цель не достигнута, этап `failed_to_fund`. Инвесторам возвращаются средства (если это предусмотрено и технически реализуемо, особенно с блокчейном).
5.  **Завершение Работ по Этапу**:
    - Стартап выполняет заявленные работы.
    - Предоставляет доказательства (возможно, через существующую систему `ProjectContent`).
    - Отмечает этап как `completed_work`. Это может триггерить активацию следующего этапа.
6.  **Отмена Кампании/Этапа**:
    - Если сбор средств на этап начался, но еще не закончился (`status = 'active'`): отмена возможна только по решению модератора DeepVest (например, при подозрении на мошенничество или по обоснованной просьбе стартапа). В случае отмены, средства инвесторов, находящиеся на эскроу-контракте, должны быть им возвращены.
    - Если сбор средств на этап успешно завершен и этап перешел в статус `funded` (средства собраны): отмена этапа стартапом невозможна, так как это нарушит обязательства перед инвесторами.
    - Стартап может отменить _будущие, еще не активные_ этапы (`status = 'pending'`) без штрафных санкций, если это не влияет на уже профинансированные этапы.
    - Для отмены всей кампании, если есть активный этап сбора, также требуется вмешательство и одобрение модератора DeepVest.
7.  **Частичный Успех Кампании**:
    - Если, например, 2 из 3 этапов успешно профинансированы и выполнены, а 3-й не собрал средства или был отменен стартапом (будучи в статусе `pending`) до начала сбора. Инвесторы первых двух этапов сохраняют свои доли. Средства за 3-й этап (если он был активен, отменен модератором, и средства были на эскроу) возвращаются.

## 4. Расчет долей и финансовые потоки

Ключевой момент — как справедливо распределить эквити.

**Модель 1: Фиксированный процент эквити за этап**

Стартап заранее определяет: "За этап X мы отдаем Y% компании".

Стартап достигает эффекта "большей доли за доллар на ранних этапах" путем установки более высокого `equity_for_milestone_percent` по отношению к `target_amount_usd` для этих ранних этапов по сравнению с более поздними и рискованными.

- `EquityForMilestone_i` = Y% (например, 5% от всей компании).
- Если инвестор `j` вложил `InvestmentAmount_j_i` в этап `i`, а всего на этапе собрано `CurrentAmount_i` (равно `TargetAmount_i` при успехе).
- Доля инвестора `j` от эквити _этого этапа_: `(InvestmentAmount_j_i / CurrentAmount_i)`.
- Абсолютная доля инвестора `j` в компании от этого этапа: `(InvestmentAmount_j_i / CurrentAmount_i) * EquityForMilestone_i`.

**Пример из сценария:**

- Стартап отдает 20% за 3 мейлстоуна.
- М1 (Идея, $5000): Допустим, стартап решает отдать 10% компании за этот этап.
- М2 (Прототип, $20000): Стартап отдает 7% компании.
- М3 (MVP, $100000): Стартап отдает 3% компании.
  Итого: 10 + 7 + 3 = 20%.

Если инвестор вложил $1000 в М1:
Его доля от М1 = ($1000 / $5000) _ 10% = (1/5) _ 10% = 2% компании.

**Переменные для настройки стартапом:**

- Общий процент эквити на всю кампанию (`total_equity_offered_percent`).
- Для каждого этапа:
  - `target_amount_usd`.
  - `equity_for_milestone_percent` (процент от всей компании, выделяемый на этот этап).
  - _Опционально_: `valuation_cap_usd` или `discount_rate` для этапа, если используется модель SAFE/Convertible Note, но это усложнит MVP. Для начала лучше прямая продажа долей.

**Формула расчета (упрощенная для прямой доли):**
`InvestorShareFromMilestone = (InvestorContributionToMilestone / MilestoneTargetAmount) * MilestoneEquityOfferedPercent`

## 5. Интеграция с блокчейном для MVP (Хакатон)

Учитывая спонсоров и необходимость простоты для хакатона:

**Выбор технологий спонсоров:**

1.  **Neon EVM**: Предоставляет EVM-совместимую среду поверх Solana. Это позволит использовать Solidity для смарт-контрактов, что является наиболее распространенным и доступным вариантом для быстрого прототипирования. Множество готовых библиотек (OpenZeppelin).
2.  **Chainlink**: Может использоваться для получения данных о курсах криптовалют к USD, если инвестиции принимаются в криптовалюте, отличной от стейблкоинов. Для MVP можно упростить и принимать только стейблкоины (USDC, USDT) или фиксировать курс на момент транзакции.
3.  **Xsolla**: Если рассматривать фиатные платежи, Xsolla может быть интегрирована для приема денег, которые затем могут быть конвертированы и отправлены на эскроу-контракт. Однако, для чисто блокчейн-демо на хакатоне это может быть избыточно. Сфокусируемся на крипто-инвестициях.

**Предлагаемое решение для хакатона (с Neon EVM):**

- **Смарт-контракт этапа (MilestoneEscrow)**, действующий как эскроу-агент под управлением/наблюдением DeepVest:
  - Создается для каждого `CampaignMilestone`.
  - Имеет `targetAmount`, `deadline` (срок окончания сбора), `startupAddress` (адрес кошелька стартапа).
  - Функция `invest()`: инвестор отправляет средства (например, USDC) на контракт. Контракт регистрирует вложение и долю инвестора.
- **Токены**:
  - Для MVP можно не создавать полноценные токены акций. Достаточно записей в смарт-контракте о сумме вложений и будущем праве на долю.
  - Если делать токены, то это могут быть простые Non-Fungible Tokens (NFTs) или Fungible Tokens (ERC20), представляющие обязательство на получение акций.
- **Управление**: DeepVest может выступать как деплоер контрактов или предоставлять интерфейс для стартапов для деплоя через свои кошельки.

**Упрощения для хакатона:**

- Один тип криптовалюты для инвестиций (например, USDC на Neon EVM).
- Простая проверка выполнения этапа (например, стартап сам нажимает кнопку "этап выполнен").
- Фокус на прозрачности сбора средств и их условном депонировании.
- Безопасность смарт-контрактов на уровне "демо", без глубокого аудита.

## 6. Пользовательские сценарии (User Flow)

**Для стартапа:**

1.  В своем проекте на DeepVest находит раздел "Краудфандинг".
2.  Создает новую кампанию: общее описание, % эквити.
3.  Добавляет этапы: цели, суммы, % эквити на этап, сроки.
4.  Публикует кампанию. Первый этап становится активным.
5.  Отслеживает прогресс сбора средств по активному этапу.
6.  При успешном сборе получает уведомление и (если через блокчейн) доступ к средствам.
7.  Отмечает выполнение работ по этапу, загружает подтверждающие материалы.
8.  При необходимости (и если возможно) отменяет будущие этапы.

**Для инвестора:**

1.  Просматривает список активных краудфандинговых кампаний на DeepVest.
2.  Фильтрует по категориям, стадиям, суммам.
3.  Изучает детали кампании и ее этапов, информацию о стартапе, предлагаемую долю.
4.  Выбирает этап для инвестирования.
5.  Подключает свой крипто-кошелек (например, MetaMask, настроенный на Neon EVM).
6.  Вводит сумму инвестиции и подтверждает транзакцию.
7.  Видит свою инвестицию и потенциальную долю в личном кабинете.
8.  Отслеживает статус этапа и кампании в целом.
9.  В случае неудачи этапа может запросить возврат средств (если предусмотрено).

## 7. MVP для хакатона

- **Backend (Supabase + TypeScript)**:
  - CRUD операции для `CrowdfundingCampaigns`, `CampaignMilestones`, `Investments`.
  - Логика смены статусов этапов и кампаний.
  - Интеграция с Neon EVM: деплой/вызов смарт-контрактов через ethers.js или web3.js.
- **Frontend (NextJS + TypeScript)**:
  - Страница создания/управления кампанией для стартапа.
  - Список кампаний и страница деталей кампании для инвесторов.
  - Интерфейс для инвестирования с подключением кошелька.
  - Отображение прогресса сбора средств.
- **Смарт-контракты (Solidity на Neon EVM)**:
  - Упрощенный `MilestoneEscrow` контракт.
- **Без чего можно обойтись на хакатоне:**
  - Сложный расчет долей в реальном времени (можно показать принцип).
  - Автоматическое создание юридических документов.
  - Глубокая интеграция с существующими `Milestones` и `ProjectContent` (можно имитировать).
  - KYC/AML для инвесторов.
  - Собственные токены акций (достаточно учета).

## 8. Потенциал для коммерческого использования

- Автоматизация юридической обвязки (генерация SAFE, KISS, договоров).
- Интеграция с KYC/AML провайдерами (например, Civic, если они подходят).
- Более сложные модели оценки и распределения эквити.
- Вторичный рынок для "фьючерсов на акции", полученных инвесторами.
- Более глубокая интеграция Chainlink для автоматической проверки выполнения некоторых этапов (если применимо).
- Система голосования для инвесторов по ключевым решениям стартапа.
- Использование Origin Trail для отслеживания происхождения и расходования средств.
- Расширение на другие блокчейны (Polkadot, Flare, Oasis).

---
